---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - pnpm-workspace.yaml
  - turbo.json
  - .gitignore
  - .npmrc
  - packages/typescript-config/package.json
  - packages/typescript-config/base.json
  - packages/typescript-config/react-native.json
  - packages/typescript-config/nestjs.json
  - packages/eslint-config/package.json
  - packages/eslint-config/base.js
autonomous: true

must_haves:
  truths:
    - "pnpm install runs successfully from root"
    - "Turborepo recognizes workspace packages"
    - "TypeScript configs can be extended by apps"
  artifacts:
    - path: "package.json"
      provides: "Root workspace config"
      contains: "workspaces"
    - path: "pnpm-workspace.yaml"
      provides: "pnpm workspace definition"
      contains: "packages:"
    - path: "turbo.json"
      provides: "Turborepo task pipeline"
      contains: "pipeline"
    - path: "packages/typescript-config/base.json"
      provides: "Shared TypeScript config"
      contains: "compilerOptions"
  key_links:
    - from: "turbo.json"
      to: "package.json"
      via: "workspace detection"
      pattern: "pipeline"
---

<objective>
Initialize Turborepo monorepo with pnpm workspaces and shared configuration packages.

Purpose: Establishes the foundational structure that all apps and packages will use. This is a prerequisite for both the NestJS backend and Expo mobile app.

Output: Working monorepo with shared TypeScript and ESLint configurations that can be extended by individual apps.
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize monorepo root with pnpm and Turborepo</name>
  <files>
    package.json
    pnpm-workspace.yaml
    turbo.json
    .gitignore
    .npmrc
  </files>
  <action>
Create the root monorepo structure:

1. Initialize package.json with:
   - name: "k7notes"
   - private: true
   - packageManager: "pnpm@9.15.0" (or latest 9.x)
   - scripts: { "dev": "turbo dev", "build": "turbo build", "lint": "turbo lint", "type-check": "turbo type-check" }
   - devDependencies: turbo (latest)

2. Create pnpm-workspace.yaml:
   ```yaml
   packages:
     - "apps/*"
     - "packages/*"
   ```

3. Create turbo.json with pipeline:
   ```json
   {
     "$schema": "https://turbo.build/schema.json",
     "pipeline": {
       "build": {
         "dependsOn": ["^build"],
         "outputs": ["dist/**", ".expo/**"]
       },
       "dev": {
         "cache": false,
         "persistent": true
       },
       "lint": {
         "outputs": []
       },
       "type-check": {
         "dependsOn": ["^build"],
         "outputs": []
       }
     }
   }
   ```

4. Create .npmrc:
   ```
   auto-install-peers=true
   strict-peer-dependencies=false
   ```

5. Update .gitignore to include:
   - node_modules
   - .turbo
   - dist
   - .expo
   - *.local

6. Create empty directories: apps/, packages/

7. Run `pnpm install` to create lockfile
  </action>
  <verify>
`pnpm install` completes without errors.
`test -d apps && test -d packages && echo "Directories exist"` outputs "Directories exist".
  </verify>
  <done>Root monorepo initialized with Turborepo and pnpm workspaces configured.</done>
</task>

<task type="auto">
  <name>Task 2: Create shared TypeScript configuration package</name>
  <files>
    packages/typescript-config/package.json
    packages/typescript-config/base.json
    packages/typescript-config/react-native.json
    packages/typescript-config/nestjs.json
  </files>
  <action>
Create the typescript-config package:

1. Create packages/typescript-config/package.json:
   ```json
   {
     "name": "@k7notes/typescript-config",
     "version": "0.0.0",
     "private": true,
     "files": ["*.json"]
   }
   ```

2. Create packages/typescript-config/base.json:
   ```json
   {
     "$schema": "https://json.schemastore.org/tsconfig",
     "compilerOptions": {
       "strict": true,
       "esModuleInterop": true,
       "skipLibCheck": true,
       "forceConsistentCasingInFileNames": true,
       "noUncheckedIndexedAccess": true,
       "isolatedModules": true,
       "moduleResolution": "bundler",
       "resolveJsonModule": true,
       "target": "ES2022",
       "lib": ["ES2022"]
     }
   }
   ```

3. Create packages/typescript-config/react-native.json:
   ```json
   {
     "$schema": "https://json.schemastore.org/tsconfig",
     "extends": "./base.json",
     "compilerOptions": {
       "jsx": "react-jsx",
       "lib": ["ES2022", "DOM"]
     }
   }
   ```

4. Create packages/typescript-config/nestjs.json:
   ```json
   {
     "$schema": "https://json.schemastore.org/tsconfig",
     "extends": "./base.json",
     "compilerOptions": {
       "module": "commonjs",
       "declaration": true,
       "declarationMap": true,
       "emitDecoratorMetadata": true,
       "experimentalDecorators": true,
       "outDir": "./dist",
       "rootDir": "./src",
       "incremental": true
     }
   }
   ```

5. Run `pnpm install` from root to register the package.
  </action>
  <verify>
`pnpm list @k7notes/typescript-config` shows the package in workspace.
  </verify>
  <done>TypeScript config package available for extension by apps.</done>
</task>

<task type="auto">
  <name>Task 3: Create shared ESLint configuration package</name>
  <files>
    packages/eslint-config/package.json
    packages/eslint-config/base.js
  </files>
  <action>
Create the eslint-config package:

1. Create packages/eslint-config/package.json:
   ```json
   {
     "name": "@k7notes/eslint-config",
     "version": "0.0.0",
     "private": true,
     "main": "base.js",
     "dependencies": {
       "@typescript-eslint/eslint-plugin": "^7.0.0",
       "@typescript-eslint/parser": "^7.0.0",
       "eslint-config-prettier": "^9.0.0"
     },
     "peerDependencies": {
       "eslint": "^8.0.0"
     }
   }
   ```

2. Create packages/eslint-config/base.js:
   ```javascript
   module.exports = {
     parser: "@typescript-eslint/parser",
     plugins: ["@typescript-eslint"],
     extends: [
       "eslint:recommended",
       "plugin:@typescript-eslint/recommended",
       "prettier"
     ],
     rules: {
       "@typescript-eslint/no-unused-vars": ["error", { "argsIgnorePattern": "^_" }],
       "@typescript-eslint/explicit-function-return-type": "off",
       "@typescript-eslint/no-explicit-any": "warn"
     },
     ignorePatterns: ["node_modules", "dist", ".expo", ".turbo"]
   };
   ```

3. Run `pnpm install` from root to install ESLint dependencies.
  </action>
  <verify>
`pnpm list @k7notes/eslint-config` shows the package in workspace.
`pnpm list eslint --filter @k7notes/eslint-config` shows eslint as peer dependency.
  </verify>
  <done>ESLint config package available for extension by apps.</done>
</task>

</tasks>

<verification>
Run from project root:
1. `pnpm install` completes successfully
2. `pnpm turbo build --dry-run` shows task graph (may be empty without apps, but no errors)
3. `ls packages/*/package.json` lists both config packages
</verification>

<success_criteria>
- Monorepo root has package.json, pnpm-workspace.yaml, turbo.json
- packages/typescript-config/ has base, react-native, and nestjs configs
- packages/eslint-config/ has base config with TypeScript support
- `pnpm install` runs without errors
- No apps yet (those come in subsequent plans)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
